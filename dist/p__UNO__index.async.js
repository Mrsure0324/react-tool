"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[198],{57408:function(Yn,U,a){a.r(U),a.d(U,{default:function(){return xn}});var X=a(25359),Y=a.n(X),W=a(49811),q=a.n(W),_=a(93525),nn=a.n(_),en=a(54306),g=a.n(en),f=a(93236),w={"flex-between":"flex-between___bfW2N",box:"box___x16Kb",inner:"inner___uwIyM"},Z=a(4779),z=a(35686),I=a(41410),m=a(65804),N=a(25283),tn=a(71258),rn=a(96641),A=a(59568),G=a(42112),on=a(93161),an=a(43872),un=a(2362),ln=a(95110),sn=a(24528),d=a(32699),cn=a(45527),dn=a(11333),vn=a.n(dn),fn=a(95170),B=a.n(fn);function hn(L){var h=L.filter(function(p){return p.point>0}),x=L.filter(function(p){return p.point<0});h.sort(function(p,D){return D.point-p.point}),x.sort(function(p,D){return p.point-D.point});for(var c=[],u=0,P=0;P<h.length;P++)for(var E=h[P],F=E.point;F>0&&u<x.length;){var T=x[u],R=Math.abs(T.point);R<=F?(c.push({winner:E.name,loser:T.name,amount:R}),F-=R,u++):(c.push({winner:E.name,loser:T.name,amount:F}),T.point+=F,F=0)}return c}var n=a(62086),$=Z.Z.Text,zn=Z.Z.Link,pn=function(h){var x=(0,f.useMemo)(function(){var c=[];for(var u in h.result)u!=="date"&&c.push({point:h.result[u],name:u});return c},[h.result]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(z.Z,{header:!1,footer:!1,bordered:!0,dataSource:x,style:{width:"100%"},renderItem:function(u){return(0,n.jsxs)(z.Z.Item,{children:[(0,n.jsx)(Z.Z.Text,{children:u==null?void 0:u.name}),u.point>0&&(0,n.jsx)(Z.Z.Text,{style:{color:"red"},children:u==null?void 0:u.point}),u.point==0&&(0,n.jsx)(Z.Z.Text,{children:u==null?void 0:u.point}),u.point<0&&(0,n.jsx)(Z.Z.Text,{style:{color:"green"},children:u==null?void 0:u.point})]})}})})},k=!0,mn=function(){var h=f.useState([]),x=g()(h,2),c=x[0],u=x[1],P=f.useState(0),E=g()(P,2),F=E[0],T=E[1],R=I.Z.useForm(),p=g()(R,1),D=p[0],Dn=f.useState([]),H=g()(Dn,2),j=H[0],O=H[1],Cn=f.useState(!1),K=g()(Cn,2),gn=K[0],V=K[1],Fn=f.useState(!0),b=g()(Fn,2),jn=b[0],J=b[1],yn=f.useState({}),Q=g()(yn,2),Zn=Q[0],Bn=Q[1];(0,f.useEffect)(function(){k&&(B().getItem("players").then(function(r){u(r||[])}),B().getItem("logs").then(function(r){O(r||[])}),k=!1)},[]);var En=function(e){var t=0;return j.forEach(function(l){t+=l[e]||0}),Number(t||0)},Pn=(0,f.useMemo)(function(){var r=(0,d.cloneDeep)(j),e={date:"\u603B\u8BA1"};return c.forEach(function(t){e[t.name]=En(t.name)}),r.push(e),Bn(e),r},[j,c]),Tn=(0,f.useMemo)(function(){var r=c.map(function(e){return{title:e.name,dataIndex:e.name,key:e.name,render:function(l){var s=Math.round(l*100)/100;return(0,n.jsxs)(n.Fragment,{children:[Number(s)>0&&(0,n.jsx)("span",{style:{color:"red"},children:"+".concat(s)}),!Number(s)&&"".concat(0),Number(s)<0&&(0,n.jsx)("span",{style:{color:"green"},children:"".concat(s)})]})}}});return[{title:"\u65E5\u671F",dataIndex:"date",key:"date",width:180}].concat(nn()(r),[{title:"\u64CD\u4F5C",width:80,fixed:"right",render:function(t,l,s){return(0,n.jsx)(n.Fragment,{children:s!==j.length&&(0,n.jsx)(m.ZP,{danger:!0,onClick:function(){return Sn(l,s)},type:"link",children:"\u5220\u9664"})})}}])},[c]),Rn=function(){B().setItem("players",[]),B().setItem("logs",[]),O([]),u([])},Sn=function(e,t){var l=(0,d.cloneDeep)(j[t]);N.Z.confirm({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",onOk:function(){var o=(0,d.cloneDeep)(j);o.splice(t,1),O(o)}})},In=function(){var r=q()(Y()().mark(function e(){var t,l;return Y()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,D.validateFields();case 3:t=D.getFieldsValue(),l=(0,d.cloneDeep)(c),l.push({name:t.name,description:"",avatar:"",point:0,type:"normal"}),u(l),D.resetFields(),tn.ZP.success((0,n.jsx)(n.Fragment,{children:"\u70ED\u70C8\u6B22\u8FCE\u3010".concat(t.name,"\u3011\u540C\u5FD7\u52A0\u5165\u6E38\u620F\uFF0C\u795D\u60A8\u798F\u5982\u4E1C\u6D77\uFF0C\u5BFF\u6BD4\u5357\u5C71~")})),o.next=13;break;case 11:o.prev=11,o.t0=o.catch(0);case 13:case"end":return o.stop()}},e,null,[[0,11]])}));return function(){return r.apply(this,arguments)}}(),Nn=function(e){var t=(0,d.cloneDeep)(c[e]);N.Z.confirm({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u3010".concat(t.name,"\u3011\u5417\uFF1F"),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",onOk:function(){var s=(0,d.cloneDeep)(c);s.splice(e,1),u(s)}})},An=function(e,t){if(t!==null){var l=(0,d.cloneDeep)(c);l[e].point=t,u(l)}},$n=function(){var e=(0,d.cloneDeep)(c);e=e.map(function(t,l){return{name:t.name,description:t.description,avatar:t.avatar,point:0,type:"normal"}}),console.log(e),u(e),J(!1)},Ln=function(e){var t={};return t.date=vn()().format("YYYY-MM-DD h:mm:ss"),e.forEach(function(l,s){t[l.name]=l.lastPoint}),t},On=function(){var e,t=(0,d.cloneDeep)(c);t.sort(function(v,M){return v.point-M.point});var l=0,s=(e=(0,d.cloneDeep)(t[1]))===null||e===void 0?void 0:e.point,o=0;t.map(function(v,M){(v==null?void 0:v.point)<=s?(v.type="winner",o++):v.type="loser"}),u(t);var S=Mn(t,o),i=S.result,y=(0,d.cloneDeep)(j),C=Ln(i);y.push(C),O(y),B().setItem("players",t),B().setItem("logs",y),J(!0),N.Z.info({width:"80%",icon:(0,n.jsx)(n.Fragment,{}),title:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("p",{children:"\u{1F3C6}\u{1F3C6}\u{1F3C6}\u7ED3\u7B97\u9875\u9762\u{1F3C6}\u{1F3C6}\u{1F3C6}"})}),content:(0,n.jsx)(pn,{result:C}),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"})},Mn=function(e,t){var l=e.filter(function(i){return i.type==="winner"}),s=0;e==null||e.forEach(function(i,y){i.type==="loser"&&(s+=i.point)});var o=s/t,S=e.map(function(i,y){var C=o;return i.type==="winner"?y===0?l==null||l.forEach(function(v,M){if(M!==0){var Un=Math.min(v==null?void 0:v.point,o);C=C+Un}}):C=o-(i==null?void 0:i.point)<0?0:o-(i==null?void 0:i.point):C=-(i==null?void 0:i.point),{rank:y+1,name:i==null?void 0:i.name,lastPoint:C}});return{result:S,plan:[]}},wn=function(e){return e==="winner"?"red":e==="loser"?"green":"blue"},Gn=function(){var e=(0,d.cloneDeep)(Zn);delete e.date;var t=[];for(var l in e)t.push({name:l,point:e[l]});t.sort(function(o,S){return S.point-o.point});var s=hn(t);N.Z.info({width:"80%",icon:(0,n.jsx)(n.Fragment,{}),title:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("p",{children:"\u{1F4B0}\u{1F4B0}\u{1F4B0}\u{1F4B0}\u{1F4B0}\u{1F4B0}\u{1F4B0}"})}),content:(0,n.jsx)(n.Fragment,{children:s.map(function(o){return(0,n.jsxs)("p",{children:[(0,n.jsx)($,{type:"success",children:o==null?void 0:o.loser}),(0,n.jsx)($,{children:"\u8F93\u7ED9"}),(0,n.jsx)($,{type:"danger",children:o==null?void 0:o.winner}),(0,n.jsx)($,{mark:!0,children:Math.round((o==null?void 0:o.amount)*10)/10}),"\u70B9\u6570"]})})}),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(cn._z,{title:"UNO\u8BA1\u5206\u5668",className:w.box,style:{minHeight:"100vh"},children:(0,n.jsxs)("div",{className:w.inner,children:[(0,n.jsxs)(I.Z,{form:D,children:[(0,n.jsx)(I.Z.Item,{rules:[{required:!0,message:"\u4F60\u5F97\u8D77\u4E2A\u540D\u554A"}],label:"Player Name",name:"name",children:(0,n.jsx)(rn.Z,{maxLength:8})}),(0,n.jsx)(I.Z.Item,{children:(0,n.jsxs)(A.Z,{children:[(0,n.jsx)(m.ZP,{onClick:In,children:"\u521B\u5EFA\u73A9\u5BB6"}),(0,n.jsx)(m.ZP,{onClick:Rn,children:"\u91CD\u5F00\u623F\u95F4"})]})})]}),(0,n.jsx)(G.Z,{}),(0,n.jsx)("p",{style:{color:"orange"},children:"\u6CE8\uFF1A\u7B2C\u4E00\u540D\u4EE5\u53CA\u5E76\u5217\u7B2C\u4E00\uFF0C\u76F4\u63A5\u8F93\u51650\u5373\u53EF"}),(0,n.jsx)(A.Z,{direction:"vertical",size:"middle",style:{width:"100%"},children:c.map(function(r,e){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(on.Z.Ribbon,{text:(0,n.jsxs)(n.Fragment,{children:[(r==null?void 0:r.type)==="winner"&&"Winner \u{1F911}",(r==null?void 0:r.type)==="loser"&&"Loser \u{1F62D}",(r==null?void 0:r.type)==="normal"&&"Ready \u{1F60E}"]}),color:wn(r==null?void 0:r.type),children:(0,n.jsx)(an.Z,{title:r.name,size:"small",children:(0,n.jsxs)("div",{className:w["flex-between"],children:[(0,n.jsx)(un.Z,{addonBefore:"-",width:50,min:0,value:r.point,onChange:function(l){return An(e,l)}}),(0,n.jsx)(m.ZP,{danger:!0,type:"link",onClick:function(){return Nn(e)},children:"\u8E22\u4E86"})]})})},e)})})}),(0,n.jsx)(G.Z,{}),(0,n.jsxs)(A.Z,{children:[(0,n.jsx)(m.ZP,{color:"success",disabled:jn,type:"primary",onClick:On,children:"\u7ED3\u7B97\u672C\u5C40"}),(0,n.jsx)(m.ZP,{color:"success",type:"primary",onClick:function(){V(!0)},children:"\u8BB0\u5206\u677F"}),(0,n.jsx)(m.ZP,{color:"success",type:"primary",onClick:function(){$n()},children:"\u65B0\u5F00\u4E00\u5C40"})]})]})}),(0,n.jsxs)(ln.Z,{title:"\u8BB0\u5206\u677F",width:1200,open:gn,onClose:function(){V(!1)},children:[(0,n.jsx)(sn.Z,{scroll:{x:"max-content"},dataSource:Pn,columns:Tn,pagination:!1}),(0,n.jsx)(G.Z,{}),(0,n.jsx)(A.Z,{children:(0,n.jsx)(m.ZP,{type:"primary",onClick:Gn,children:"\u751F\u6210\u7ED3\u7B97\u65B9\u6848"})})]})]})},xn=mn}}]);
