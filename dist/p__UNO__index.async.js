"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[198],{37373:function(Qn,z,o){o.r(z),o.d(z,{default:function(){return Bn}});var en=o(25359),U=o.n(en),tn=o(49811),rn=o.n(tn),an=o(93525),on=o.n(an),ln=o(54306),x=o.n(ln),v=o(93236),C={"flex-between":"flex-between___bfW2N",box:"box___x16Kb",wrapper:"wrapper___Xsz5s",inner:"inner___uwIyM","total-item":"total-item___UBkqK",winner:"winner___V4ukZ",loser:"loser___zrkXt","start-button":"start-button___VrvIm",startButton:"startButton___PGF87"},b=o(50239),A=o(87963),I=o(8637),p=o(60614),N=o(65613),un=o(62636),L=o(19043),sn=o(34667),k=o(27759),cn=o(15305),H=o(89803),V=o(11436),dn=o(32595),vn=o(65958),fn=o(75732),pn=o(52990),mn=o(48722),d=o(32699),hn=o(98657),xn=o(11333),Fn=o.n(xn),jn=o(95170),B=o.n(jn);function gn($){var m=$.filter(function(h){return h.point>0}),F=$.filter(function(h){return h.point<0});m.sort(function(h,j){return j.point-h.point}),F.sort(function(h,j){return h.point-j.point});for(var s=[],l=0,P=0;P<m.length;P++)for(var E=m[P],D=E.point;D>0&&l<F.length;){var T=F[l],S=Math.abs(T.point);S<=D?(s.push({winner:E.name,loser:T.name,amount:S}),D-=S,l++):(s.push({winner:E.name,loser:T.name,amount:D}),T.point+=D,D=0)}return s}var yn=[{name:"Ye\u54E5",point:0,type:"normal"},{name:"Sure",point:0,type:"normal"},{name:"\u4E09\u91D1",point:0,type:"normal"},{name:"\u82D7\u82D7",point:0,type:"normal"},{name:"\u73A5\u73A5",point:0,type:"normal"}],Cn=o(47778),n=o(62086),Dn=function(m){var F=(0,v.useMemo)(function(){var s=[];for(var l in m.result)l!=="date"&&s.push({point:m.result[l],name:l});return s},[m.result]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(b.Z,{header:!1,footer:!1,bordered:!0,dataSource:F,style:{width:"100%"},renderItem:function(l){return(0,n.jsxs)(b.Z.Item,{children:[(0,n.jsx)(A.Z.Text,{children:l==null?void 0:l.name}),l.point>0&&(0,n.jsx)(A.Z.Text,{style:{color:"red"},children:l==null?void 0:l.point}),l.point==0&&(0,n.jsx)(A.Z.Text,{children:l==null?void 0:l.point}),l.point<0&&(0,n.jsx)(A.Z.Text,{style:{color:"green"},children:l==null?void 0:l.point})]})}})})},K=!0,Zn=function(){var m=v.useState([]),F=x()(m,2),s=F[0],l=F[1],P=v.useState(0),E=x()(P,2),D=E[0],T=E[1],S=I.Z.useForm(),h=x()(S,1),j=h[0],En=v.useState([]),X=x()(En,2),g=X[0],w=X[1],Pn=v.useState(!1),Y=x()(Pn,2),Tn=Y[0],J=Y[1],Sn=v.useState(!1),Q=x()(Sn,2),Rn=Q[0],G=Q[1],An=v.useState(!0),W=x()(An,2),M=W[0],q=W[1],In=v.useState({}),_=x()(In,2),Nn=_[0],$n=_[1];(0,v.useEffect)(function(){K&&(B().getItem("players").then(function(r){l(r||[])}),B().getItem("logs").then(function(r){w(r||[])}),K=!1)},[]);var nn=function(t){var e=0;return g.forEach(function(u){e+=u[t]||0}),Number(e||0)},wn=(0,v.useMemo)(function(){var r=(0,d.cloneDeep)(g),t={date:"\u603B\u8BA1"};return s.forEach(function(e){t[e.name]=nn(e.name)}),$n(t),r.reverse()},[g,s]),On=(0,v.useMemo)(function(){var r=s.map(function(t){var e;return{title:t.name,dataIndex:t.name,key:t.name,width:Math.max(Math.min(((e=t.name)===null||e===void 0?void 0:e.length)*25,80),70),render:function(c){var a=Math.round(c*100)/100;return(0,n.jsxs)(n.Fragment,{children:[Number(a)>0&&(0,n.jsx)("span",{style:{color:"red"},children:"+".concat(a)}),!Number(a)&&"".concat(0),Number(a)<0&&(0,n.jsx)("span",{style:{color:"green"},children:"".concat(a)})]})}}});return[{title:"\u65E5\u671F",dataIndex:"date",key:"date",width:100}].concat(on()(r),[{title:"\u64CD\u4F5C",width:50,fixed:"right",render:function(e,u,c){return(0,n.jsx)(n.Fragment,{children:c!==g.length&&(0,n.jsx)(p.ZP,{style:{paddingLeft:0},danger:!0,onClick:function(){return Gn(u,c)},type:"link",children:"\u5220\u9664"})})}}])},[s,g]),Ln=function(){B().setItem("players",[]),B().setItem("logs",[]),w([]),l([])},Gn=function(t,e){var u=(0,d.cloneDeep)(g[e]);N.Z.confirm({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",onOk:function(){var a=(0,d.cloneDeep)(g);a.splice(e,1),w(a)}})},Mn=function(){var r=rn()(U()().mark(function t(){var e,u;return U()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,j.validateFields();case 3:e=j.getFieldsValue(),u=(0,d.cloneDeep)(s),u.push({name:e.name,description:"",avatar:"",point:0,type:"normal"}),l(u),j.resetFields(),un.ZP.success((0,n.jsx)(n.Fragment,{children:"\u70ED\u70C8\u6B22\u8FCE\u3010".concat(e.name,"\u3011\u540C\u5FD7\u52A0\u5165\u6E38\u620F\uFF0C\u795D\u60A8\u798F\u5982\u4E1C\u6D77\uFF0C\u5BFF\u6BD4\u5357\u5C71~")})),a.next=13;break;case 11:a.prev=11,a.t0=a.catch(0);case 13:case"end":return a.stop()}},t,null,[[0,11]])}));return function(){return r.apply(this,arguments)}}(),zn=function(t){var e=(0,d.cloneDeep)(s[t]);N.Z.confirm({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u3010".concat(e.name,"\u3011\u5417\uFF1F"),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",onOk:function(){var c=(0,d.cloneDeep)(s);c.splice(t,1),l(c)}})},Un=function(t,e){if(e!==null){var u=(0,d.cloneDeep)(s);u[t].point=e,l(u)}},bn=function(){var t=(0,d.cloneDeep)(s);t=t.map(function(e,u){return{name:e.name,description:e.description,avatar:e.avatar,point:0,type:"normal"}}),console.log(t),l(t),q(!1)},kn=function(t){var e={};return e.date=Fn()().format("HH:mm:ss"),t.forEach(function(u,c){e[u.name]=u.lastPoint}),e},Hn=function(){var t,e=(0,d.cloneDeep)(s);e.sort(function(f,O){return f.point-O.point});var u=0,c=(t=(0,d.cloneDeep)(e[1]))===null||t===void 0?void 0:t.point,a=0;e.map(function(f,O){(f==null?void 0:f.point)<=c?(f.type="winner",a++):f.type="loser"}),l(e);var R=Vn(e,a),i=R.result,Z=(0,d.cloneDeep)(g),y=kn(i);Z.push(y),w(Z),B().setItem("players",e),B().setItem("logs",Z),q(!0),N.Z.info({width:"80%",icon:(0,n.jsx)(n.Fragment,{}),title:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("p",{children:"\u{1F3C6}\u{1F3C6}\u{1F3C6}\u7ED3\u7B97\u9875\u9762\u{1F3C6}\u{1F3C6}\u{1F3C6}"})}),content:(0,n.jsx)(Dn,{result:y}),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"})},Vn=function(t,e){var u=t.filter(function(i){return i.type==="winner"}),c=0;t==null||t.forEach(function(i,Z){i.type==="loser"&&(c+=i.point)});var a=c/e,R=t.map(function(i,Z){var y=a;return i.type==="winner"?Z===0?u==null||u.forEach(function(f,O){if(O!==0){var Jn=Math.min(f==null?void 0:f.point,a);y=y+Jn}}):y=a-(i==null?void 0:i.point)<0?0:a-(i==null?void 0:i.point):y=-(i==null?void 0:i.point),{rank:Z+1,name:i==null?void 0:i.name,lastPoint:y}});return{result:R,plan:[]}},Kn=function(t){return t==="winner"?"red":t==="loser"?"green":"blue"},Xn=function(){var t=(0,d.cloneDeep)(Nn);delete t.date;var e=[];for(var u in t)e.push({name:u,point:t[u]});e.sort(function(a,R){return R.point-a.point});var c=gn(e);N.Z.info({width:"80%",icon:(0,n.jsx)(n.Fragment,{}),title:(0,n.jsx)(n.Fragment,{children:"\u7ED3\u7B97\u65B9\u6848"}),content:(0,n.jsx)(n.Fragment,{children:c.map(function(a){return(0,n.jsxs)("div",{style:{fontSize:"16px"},children:[(0,n.jsxs)("span",{children:["\u3010",a==null?void 0:a.loser,"\u3011"]}),(0,n.jsx)("span",{children:"\u8F93\u7ED9"}),(0,n.jsxs)("span",{children:["\u3010",a==null?void 0:a.winner,"\u3011"]}),(0,n.jsx)("span",{style:{color:"red"},children:Math.round((a==null?void 0:a.amount)*10)/10/10}),"\u5143"]})})}),okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88"})},Yn=function(){l(yn)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:C.box,children:(0,n.jsxs)(hn._z,{title:!1,className:C.wrapper,style:{minHeight:"100vh"},children:[(s==null?void 0:s.length)>0&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:C.inner,children:[(0,n.jsx)("p",{style:{color:"orange"},children:"\u6CE8\uFF1A\u7B2C\u4E00\u540D\u4EE5\u53CA\u5E76\u5217\u7B2C\u4E00\uFF0C\u76F4\u63A5\u8F93\u51650\u5373\u53EF"}),(0,n.jsx)(L.Z,{direction:"vertical",size:"middle",style:{width:"100%"},children:s.map(function(r,t){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(sn.Z.Ribbon,{text:(0,n.jsxs)(n.Fragment,{children:[(r==null?void 0:r.type)==="winner"&&"Winner \u{1F911}",(r==null?void 0:r.type)==="loser"&&"Loser \u{1F62D}",(r==null?void 0:r.type)==="normal"&&"Ready \u{1F60E}"]}),color:Kn(r==null?void 0:r.type),children:(0,n.jsx)(k.Z,{title:r.name,size:"small",children:(0,n.jsxs)("div",{className:C["flex-between"],children:[(0,n.jsx)(cn.Z,{disabled:M,addonBefore:"-",width:50,min:0,value:r.point,onChange:function(u){return Un(t,u)}}),(0,n.jsx)(p.ZP,{danger:!0,type:"link",onClick:function(){return zn(t)},children:"\u8E22\u51FA\u623F\u95F4"})]})})},t)})})}),(0,n.jsx)(H.Z,{}),(0,n.jsxs)(L.Z,{children:[(0,n.jsx)(p.ZP,{color:"success",disabled:M,type:"primary",onClick:Hn,children:"\u7ED3\u7B97\u672C\u5C40"}),(0,n.jsx)(p.ZP,{color:"success",type:"primary",onClick:function(){J(!0)},children:"\u8BB0\u5206\u677F"}),(0,n.jsx)(p.ZP,{color:"success",disabled:!M,type:"primary",onClick:function(){bn()},children:"\u65B0\u5F00\u4E00\u5C40"})]})]})}),(s==null?void 0:s.length)<=0&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{onClick:function(){return G(!0)},className:C["start-button"]})})]})}),(0,n.jsxs)(V.Z,{title:"\u8BB0\u5206\u677F",width:1200,open:Tn,onClose:function(){J(!1)},children:[(0,n.jsx)(k.Z,{title:"\u5206\u6570\u603B\u8BA1\uFF1A",size:"small",children:(0,n.jsx)(dn.Z,{children:s.map(function(r,t){var e=nn(r.name),u="normal";return e>0&&(u="winner"),e<0&&(u="loser"),(0,n.jsx)(vn.Z,{span:8,children:(0,n.jsx)("div",{className:"".concat(C["total-item"]," ").concat(C[u]),children:"".concat(r.name,"\uFF1A").concat(e)})})})})}),(0,n.jsx)("br",{}),(0,n.jsx)(fn.Z,{scroll:{y:400},dataSource:wn,columns:On,pagination:!1,size:"small"}),(0,n.jsx)(H.Z,{}),(0,n.jsx)(p.ZP,{type:"primary",onClick:Xn,children:"\u751F\u6210\u7ED3\u7B97\u65B9\u6848"})]}),(0,n.jsx)(V.Z,{title:"\u64CD\u4F5C\u9762\u677F",placement:"bottom",open:Rn,onClose:function(){return G(!1)},children:(0,n.jsxs)(I.Z,{form:j,children:[(0,n.jsx)(I.Z.Item,{rules:[{required:!0,message:"\u4F60\u5F97\u8D77\u4E2A\u540D\u554A"}],label:"Player Name",name:"name",children:(0,n.jsx)(pn.Z,{maxLength:8})}),(0,n.jsx)(I.Z.Item,{children:(0,n.jsxs)(L.Z,{children:[(0,n.jsx)(p.ZP,{onClick:Mn,children:"\u521B\u5EFA\u73A9\u5BB6"}),(0,n.jsx)(p.ZP,{onClick:Ln,children:"\u91CD\u5F00\u623F\u95F4"}),(0,n.jsx)(p.ZP,{onClick:Yn,children:"\u52A0\u8F7D\u9ED8\u8BA4\u73A9\u5BB6"})]})})]})}),(0,n.jsx)(mn.Z,{shape:"circle",style:{right:12},icon:(0,n.jsx)(Cn.Z,{}),onClick:function(){return G(!0)}})]})},Bn=Zn}}]);
