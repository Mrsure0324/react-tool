(self.webpackChunk=self.webpackChunk||[]).push([[702],{34768:function(v,P,d){"use strict";d.r(P),d.d(P,{default:function(){return ot}});var D=d(68608),L=d.n(D),w=d(58853),M=d.n(w),I=d(38888),te=d.n(I),ce=d(52510),f=d.n(ce),X=d(63466),O=d.n(X),Q=d(21140),T=d.n(Q),Fn=d(93236),Cn=d(19103),Tn=d(25359),C=d.n(Tn),kn=d(49811),z=d.n(kn),In=d(57213),B=d.n(In),x=d(32699),On=O()(function n(e){var r=this;T()(this,n),f()(this,"monacoEditorVersion","0.15.6"),f()(this,"parserType","odps"),f()(this,"language","sql"),f()(this,"onParse",function(t){}),f()(this,"onSuggestTableNames",function(t){return Promise.resolve(["dt","b2b","tmall","chsDataBase"].map(function(i){return{label:i,insertText:i,sortText:"A".concat(i),kind:r.monaco.languages.CompletionItemKind.Folder}}))}),f()(this,"onSuggestTableFields",function(t){return Promise.resolve(["aa","bb","cc"].map(function(i){return i}).map(function(i){return{label:i,insertText:i,sortText:"B".concat(i),kind:r.monaco.languages.CompletionItemKind.Field}}))}),f()(this,"pipeKeywords",function(t){return t.filter(function(i){return i.type==="string"}).map(function(i){var u=/[a-zA-Z]+/.test(i.value.toString())?x.upperCase(i.value.toString()):i.value.toString();return{label:u,insertText:u,documentation:"documentation",detail:"detail",kind:r.monaco.languages.CompletionItemKind.Keyword,sortText:"W".concat(i.value)}})}),f()(this,"onSuggestFunctionName",function(t){return Promise.resolve(["sum","count"].map(function(i){return{label:i,insertText:i,sortText:"C".concat(i),kind:r.monaco.languages.CompletionItemKind.Function}}))}),f()(this,"onSuggestFieldGroup",function(t){return{label:t,insertText:t,sortText:"D".concat(t),kind:r.monaco.languages.CompletionItemKind.Folder}}),f()(this,"onHoverTableField",function(){for(var t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];return Promise.resolve([{value:"onHoverTableField"},{value:"```json\n".concat(JSON.stringify(i,null,2),"\n```")}])}),f()(this,"onHoverTableName",function(){for(var t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];return Promise.resolve([{value:"onHoverTableName"},{value:"```json\n".concat(JSON.stringify(i,null,2),"\n```")}])}),f()(this,"onHoverFunctionName",function(){for(var t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];return Promise.resolve([{value:"onHoverFunctionName"},{value:"```json\n".concat(JSON.stringify(i,null,2),"\n```")}])}),this.monaco=e});function xe(n,e){return we.apply(this,arguments)}function we(){return we=z()(C()().mark(function n(e,r){var t,i,u;return C()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e){s.next=2;break}return s.abrupt("return",null);case 2:if(t=x.get(e,r),i=r.slice().pop(),u=x.get(e,r.slice(0,r.length-1)),u){s.next=7;break}return s.abrupt("return",null);case 7:return s.next=9,$e(u,function(){var l=z()(C()().mark(function c(y){return C()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:h.t0=y,h.next=h.t0==="identifier.tableName"?3:h.t0==="identifier.column"?4:h.t0==="identifier.columnAfterGroup"?7:h.t0==="function"?8:9;break;case 3:return h.abrupt("return",{type:"tableName",variant:i,token:t,tableInfo:u});case 4:if(i!=="name"){h.next=6;break}return h.abrupt("return",{type:"tableField",token:t});case 6:return h.abrupt("return",null);case 7:return h.abrupt("return",{type:"tableFieldAfterGroup",token:t,groupName:u.groupName.value});case 8:return h.abrupt("return",{type:"functionName",token:t});case 9:case"end":return h.stop()}},c)}));return function(c){return l.apply(this,arguments)}}());case 9:return s.abrupt("return",s.sent);case 10:case"end":return s.stop()}},n)})),we.apply(this,arguments)}function Fe(n,e,r){if(!n||e.length===0)return null;var t=x.get(n,e);if(!t)throw Error("Path not found from ast!");if(!t.token&&t.type==="statement")if(r){if(r(t)===!0)return t}else return t;return e.length>1?Fe(n,e.slice(0,e.length-1),r):null}function Ce(n,e,r){return Te.apply(this,arguments)}function Te(){return Te=z()(C()().mark(function n(e,r,t){var i,u,o,s;return C()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,xe(e,r);case 2:if(i=c.sent,u=Fe(e,r),u){c.next=6;break}return c.abrupt("return",[]);case 6:c.t0=u.variant,c.next=c.t0==="select"?9:c.t0==="join"?10:14;break;case 9:return c.abrupt("return",pe(u,x.get(u,"from.sources",[]),i,t));case 10:return o=r.slice(),o.pop(),s=Fe(e,o,function(y){return y.variant==="select"}),c.abrupt("return",pe(s,x.get(s,"from.sources",[]),i,t));case 14:return c.abrupt("return",[]);case 15:case"end":return c.stop()}},n)})),Te.apply(this,arguments)}function pe(n,e,r,t){return ke.apply(this,arguments)}function ke(){return ke=z()(C()().mark(function n(e,r,t,i){var u;return C()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Promise.all(r.map(function(l){return Ie(e,l,t,i)}));case 2:return u=s.sent,s.abrupt("return",x.flatten(u).filter(function(l){return!!l}));case 4:case"end":return s.stop()}},n)})),ke.apply(this,arguments)}function Ie(n,e,r,t){return Oe.apply(this,arguments)}function Oe(){return Oe=z()(C()().mark(function n(e,r,t,i){return C()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",$e(r,function(){var s=z()(C()().mark(function l(c){var y,p,h,S,$,H,g,_,m,A,K;return C()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:N.t0=c,N.next=N.t0==="statement.tableSource"?3:N.t0==="statement.join"?15:N.t0==="identifier.table"?16:N.t0==="statement.select"?26:34;break;case 3:return N.next=5,Ie(e,r.source,t,i);case 5:if(y=N.sent,!x.isArray(r.joins)){N.next=12;break}return N.next=9,pe(e,x.get(r,"joins",[]),t,i);case 9:N.t1=N.sent,N.next=13;break;case 12:N.t1=[];case 13:return p=N.t1,N.abrupt("return",y.concat(p));case 15:return N.abrupt("return",Ie(e,r.join,t,i));case 16:return h=r,N.next=19,i(h.name,t.token.value,e);case 19:return S=N.sent,$=x.get(h,"name.tableNames",[]),H=null,g=x.get(h,"alias.value"),g?H=g:(_=0,$.forEach(function(E){var Z=x.get(h,"name.".concat(E,".value"));Z&&(_++,H=Z)}),_>1&&(H=null)),S=S.map(function(E){return B()(B()({},E),{},{tableInfo:h.name,groupPickerName:H,originFieldName:E.label})}),N.abrupt("return",S);case 26:return m=r,A=[],N.next=30,pe(m,m.from.sources,t,i);case 30:return K=N.sent,m.result.length===1&&m.result[0].name.value==="*"?A=K.slice():A=K.map(function(E){var Z=m.result.find(function(U){return x.get(U.name,"token")===!0?U.name.value===E.label:x.get(U.name,"type")==="identifier"&&x.get(U.name,"variant")==="columnAfterGroup"?x.get(U.name,"name.value")===E.label:x.get(U.name,"type")==="identifier"&&x.get(U.name,"variant")==="groupAll"?x.get(U.name,"groupName.value")===E.groupPickerName:!1});return Z?Z.alias?B()(B()({},E),{},{label:Z.alias.value}):E:null}).filter(function(E){return E!==null}).slice(),x.has(m,"alias.value")&&(A=A.map(function(E){return B()(B()({},E),{},{groupPickerName:x.get(m,"alias.value")})})),N.abrupt("return",A);case 34:return N.abrupt("return",null);case 35:case"end":return N.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()));case 1:case"end":return o.stop()}},n)})),Oe.apply(this,arguments)}function $e(n,e){return Pe.apply(this,arguments)}function Pe(){return Pe=z()(C()().mark(function n(e,r){return C()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return",null);case 2:if(!e.variant){i.next=4;break}return i.abrupt("return",r("".concat(e.type,".").concat(e.variant)));case 4:return i.abrupt("return",r(e.type));case 5:case"end":return i.stop()}},n)})),Pe.apply(this,arguments)}function ze(n,e,r,t){return Ee.apply(this,arguments)}function Ee(){return Ee=z()(C()().mark(function n(e,r,t,i){var u,o;return C()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Ce(e,i,t);case 2:if(u=l.sent,o=u.find(function(c){return c.label===r.token.value}),o){l.next=6;break}return l.abrupt("return",null);case 6:return l.abrupt("return",o);case 7:case"end":return l.stop()}},n)})),Ee.apply(this,arguments)}var Ae=new Map,he=1e6,Pn=O()(function n(){T()(this,n),f()(this,"rootChainNode",null),f()(this,"firstSet",new Map),f()(this,"firstOrFunctionSet",new Map),f()(this,"relatedSet",new Map)}),En=O()(function n(e,r){T()(this,n),f()(this,"restChances",[]),f()(this,"stop",!1),this.scanner=e,this.parser=r}),An=O()(function n(){T()(this,n),f()(this,"onCallVisiter",void 0),f()(this,"onVisiterNextNode",void 0),f()(this,"onSuccess",void 0),f()(this,"onFail",void 0),f()(this,"onMatchNode",void 0),f()(this,"generateAst",!0),f()(this,"enableFirstSet",!0)}),le=O()(function n(e){T()(this,n),f()(this,"parentNode",void 0),f()(this,"childs",[]),f()(this,"astResults",[]),f()(this,"creatorFunction",null),f()(this,"functionName",void 0),f()(this,"solveAst",null),this.parentIndex=e}),me=O()(function n(e){T()(this,n),f()(this,"parentNode",void 0),f()(this,"childs",[]),this.parentIndex=e}),Me=O()(function n(e,r,t){var i=this;T()(this,n),f()(this,"parentNode",void 0),f()(this,"run",function(){return i.chainFunction()(i.parentNode,i.chainFunction,i.parentIndex,i.parser)}),this.chainFunction=e,this.parentIndex=r,this.parser=t}),ee=O()(function n(e,r,t){var i=this;T()(this,n),f()(this,"parentNode",void 0),f()(this,"run",function(u){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return i.matchFunction(u,o)}),this.matchFunction=e,this.matching=r,this.parentIndex=t}),Mn=O()(function n(){T()(this,n),f()(this,"cursorTokenExcludes",function(){return!1})});function Vn(n,e){return typeof e=="string"?ge(n,e):e.some(function(r){return ge(n,r)})}function ge(n,e){return n===null?!1:(n&&n.toLowerCase())===(e&&e.toLowerCase())}function We(n,e,r){var t=n.read();return t?e(t)?(r&&n.next(),{token:t,match:!0}):{token:t,match:!1}:{token:null,match:!1}}function Ge(n,e){return function(r){function t(){return function(i,u){return n(i,r,u)}}return t.parserName="match",t.displayName=e,t}}var jn=Ge(function(n,e,r){return We(n,function(t){return Vn(t.value,e)},r)}),ye=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=B()({includes:[],excludes:[]},r);return Ge(function(i,u,o){return We(i,function(s){return t.includes.some(function(l){return ge(l,s.value)})?!0:!(t.excludes.some(function(l){return ge(l,s.value)})||s.type!==e)},o)},e)()},Bn=function(){return{token:null,match:!0}},Ln=function(){return{token:null,match:!0}},b=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];if(r.length===0)throw Error("Must have arguments!");return a([a.apply(void 0,r)(function(i){return r.length===1?i[0]:i}),!0])(function(i){return i[0]})},Ue=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];if(r.length===0)throw Error("Must have arguments!");var i=function u(){return a(a.apply(void 0,r)(function(o){return r.length===1?o[0]:o}),b(u))(function(o){return o[1]?[o[0]].concat(o[1]):[o[0]]})};return i},k=function(){if(arguments.length===0)throw Error("Must have arguments!");return b(Ue.apply(void 0,arguments))},Rn=d(54689),be=d.n(Rn),Ve=O()(function n(e){var r=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;T()(this,n),f()(this,"tokens",[]),f()(this,"index",0),f()(this,"read",function(){var i=r.tokens[r.index];return i||!1}),f()(this,"next",function(){r.index+=1}),f()(this,"isEnd",function(){return r.index>=r.tokens.length}),f()(this,"getIndex",function(){return r.index}),f()(this,"setIndex",function(i){return r.index=i,i}),f()(this,"getRestTokenCount",function(){return r.tokens.length-r.index-1}),f()(this,"getNextByToken",function(i){var u=r.tokens.findIndex(function(o){return o===i});if(u>-1)return u+1<r.tokens.length?r.tokens[u+1]:null;throw Error("token ".concat(i.value.toString()," not exist in scanner."))}),f()(this,"getTokenByCharacterIndex",function(i){if(i===null)return null;var u=be()(r.tokens),o;try{for(u.s();!(o=u.n()).done;){var s=o.value;if(i>=s.position[0]&&i-1<=s.position[1])return s}}catch(l){u.e(l)}finally{u.f()}return null}),f()(this,"getPrevTokenByCharacterIndex",function(i){var u=null,o=null;return r.tokens.forEach(function(s,l){s.position[1]<i-1&&(u=s,o=l)}),{prevToken:u,prevTokenIndex:o}}),f()(this,"getNextTokenFromCharacterIndex",function(i){var u=be()(r.tokens),o;try{for(u.s();!(o=u.n()).done;){var s=o.value;if(s.position[0]>i)return s}}catch(l){u.e(l)}finally{u.f()}return null}),f()(this,"addToken",function(i){var u=r.getPrevTokenByCharacterIndex(i.position[0]),o=u.prevToken,s=u.prevTokenIndex;o?r.tokens.splice(s+1,0,i):r.tokens.unshift(i)}),this.tokens=e.slice(),this.index=t}),Hn=d(37635),Kn=d.n(Hn),Dn=function(e,r){return typeof e=="string"&&typeof r=="string"?e.toLowerCase()===r.toLowerCase():e===r},ct=function(e){return e[1]?[e[0]].concat(e[1][1]):[e[0]]};function Je(n){var e,r=!1,t=[];return function(){if(t.push(arguments),!r){for(r=!0;t.length;)e=n.apply(this,t.shift());return r=!1,e}}}function Ze(n,e,r){r=r||"";var t="";for(var i in n){if(n[i]&&n[i].token===!0&&n[i].position[0]<=e&&n[i].position[1]+1>=e)return r===""?i:"".concat(r,".").concat(i);Kn()(n[i])==="object"&&(t=Ze(n[i],e,r===""?i:"".concat(r,".").concat(i))||t)}return t}var $n=function n(e,r,t,i){if(e instanceof Array){var u=new me(t);return u.parentNode=r,u.childs=e.map(function(h,S){return n(h,u,S,i)}),u}if(typeof e=="string"){var o=new ee(jn(e)(),{type:"string",value:e},t);return o.parentNode=r,o}if(typeof e=="boolean"){if(e){var s=new ee(Bn,{type:"loose",value:!0},t);return s.parentNode=r,s}var l=new ee(Ln,{type:"loose",value:!1},t);return l.parentNode=r,l}if(typeof e=="function"){if(e.parserName==="match"){var c=new ee(e(),{type:"special",value:e.displayName},t);return c.parentNode=r,c}if(e.parserName==="chainNodeFactory"){var y=e(r,null,t,i);return y}var p=new Me(e,t,i);return p.parentNode=r,p}throw Error("unknow element in chain ".concat(e))},a=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(o){return o},u=function(s,l){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3?arguments[3]:void 0,p=new le(c);return p.parentNode=s,p.creatorFunction=l,p.solveAst=i,p.childs=r.map(function(h,S){return $n(h,p,S,y)}),l&&Qn(p,y),p};return u.parserName="chainNodeFactory",u}};function zn(n){if(Ae.has(n))return Ae.get(n);var e=new Pn;return e.rootChainNode=n()(null,null,0,e),console.log("in getParser:",e),Ae.set(n,e),e}function Wn(n,e,r){var t=e;if(e===null)return{scanner:n,finalCursorIndex:t};var i=n.getTokenByCharacterIndex(e);return i?r.cursorTokenExcludes(i)&&(n.addToken({type:"cursor",value:null,position:[e+1,e+1]}),t+=1):n.addToken({type:"cursor",value:null,position:[e,e]}),{scanner:n,finalCursorIndex:t}}var Gn=function(e,r,t){return function(i){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;t=(0,x.defaults)(t||{},new Mn);var o=new Date,s=r(i),l=new Date,c=new Ve(s),y=Wn(new Ve(s),u,t),p=y.scanner,h=y.finalCursorIndex;u=h;var S=zn(e);console.log("parser",S);var $=p.getPrevTokenByCharacterIndex(u).prevToken,H=$===null?[S.rootChainNode]:[],g=!1,_=null,m=0,A=0,K=null;je({node:S.rootChainNode,scanner:c,visiterOption:{onCallVisiter:function(V,j){m+=1,m>he&&(j.stop=!0)},onVisiterNextNode:function(V,j){A+=1,A>he&&(j.stop=!0)},onMatchNode:function(V,j,de){var re=V.run(j.scanner);if(!re.match)fe(V,j,de);else{var wn=j.scanner.getRestTokenCount();(!K||K&&K.restTokenCount>wn)&&(K={matchNode:V,token:re.token,restTokenCount:wn}),ae(V,j,de,B()({token:!0},re.token))}},onSuccess:function(){g=!0},onFail:function(V){g=!1}},parser:S}),je({node:S.rootChainNode,scanner:p,visiterOption:{onCallVisiter:function(V,j){m+=1,m>he&&(j.stop=!0)},onVisiterNextNode:function(V,j){A+=1,A>he&&(j.stop=!0)},onSuccess:function(){_=S.rootChainNode.solveAst?S.rootChainNode.solveAst(S.rootChainNode.astResults):S.rootChainNode.astResults},onMatchNode:function(V,j,de){var re=V.run(j.scanner);re.match?($!==null&&re.token===$&&H.push(V),ae(V,j,de,B()({token:!0},re.token))):fe(V,j,de)}},parser:S}),H=(0,x.uniq)(H);var se=H.reduce(function(F,V){return F.concat(Le(V,S))},[]);se=(0,x.uniqBy)(se,function(F){return F.matching.type+F.matching.value});var N=p.getNextTokenFromCharacterIndex(u);N&&(se=se.filter(function(F){return!Dn(F.matching.value,N.value)}));var E=null;if(!g){var Z=(0,x.uniqBy)(Le(K?K.matchNode:S.rootChainNode,S).map(function(F){return F.matching}),function(F){return F.type+F.value}),U=K&&p.getNextByToken(K.token);U?E={suggestions:Z,token:U,reason:"wrong"}:E={suggestions:Z,token:K?K.token:null,reason:"incomplete"}}var st=new Date,xn=Ze(_,u).split(".");return{success:g,ast:_,cursorKeyPath:xn[0]===""?[]:xn,nextMatchings:se.reverse().map(function(F){return F.matching}).filter(function(F){return!!F.value}),error:E,debugInfo:{tokens:s,callVisiterCount:m,costs:{lexer:l.getTime()-o.getTime(),parser:st.getTime()-o.getTime()}}}}};function je(n){var e=n.node,r=n.scanner,t=n.visiterOption,i=n.parser,u=new An;(0,x.defaults)(t,u);var o=new En(r,i);ie({node:e,store:o,visiterOption:t,childIndex:0})}var ie=Je(function(n){var e=n.node,r=n.store,t=n.visiterOption,i=n.childIndex;if(r.stop){Be(e,r,t);return}if(!e)throw Error("no node!");if(t.onCallVisiter&&t.onCallVisiter(e,r),e instanceof le){if(Xn(e,r,t,i))return;Xe({node:e,store:r,visiterOption:t,childIndex:i})}else if(e instanceof me)Xe({node:e,store:r,visiterOption:t,childIndex:i});else if(e instanceof ee)if(e.matching.type==="loose")if(e.matching.value===!0)ae(e,r,t,null);else throw Error("Not support loose false!");else t.onMatchNode(e,r,t);else if(e instanceof Me){var u=e.chainFunction.name,o=e.run();o.functionName=u,e.parentNode.childs[e.parentIndex]=o,ie({node:o,store:r,visiterOption:t,childIndex:0})}else throw Error("Unexpected node type: ".concat(e))});function Xe(n){var e=n.node,r=n.store,t=n.visiterOption,i=n.childIndex;if(e instanceof le){var u=e.childs[i];u?ie({node:u,store:r,visiterOption:t,childIndex:0}):ae(e,r,t,t.generateAst?e.solveAst(e.astResults):null)}else{var o=e.childs[i];if(i+1<e.childs.length&&Jn({node:e,store:r,visiterOption:t,tokenIndex:r.scanner.getIndex(),childIndex:i+1,addToNextMatchNodeFinders:!0}),o)ie({node:o,store:r,visiterOption:t,childIndex:0});else throw Error("tree node unexpect end")}}var ae=Je(function(n,e,r,t){if(e.stop){Be(n,e,r);return}if(r.onVisiterNextNode&&r.onVisiterNextNode(n,e),!n.parentNode)return Un(n,e,r);if(n.parentNode instanceof le)r.generateAst&&(n.parentNode.astResults[n.parentIndex]=t),ie({node:n.parentNode,store:e,visiterOption:r,childIndex:n.parentIndex+1});else if(n.parentNode instanceof me)ae(n.parentNode,e,r,t);else throw Error("Unexpected parent node type: ".concat(n.parentNode))});function Un(n,e,r){e.scanner.isEnd()?r.onSuccess&&r.onSuccess():fe(n,e,r)}function Jn(n){var e=n.node,r=n.store,t=n.visiterOption,i=n.tokenIndex,u=n.childIndex,o=n.addToNextMatchNodeFinders,s={node:e,tokenIndex:i,childIndex:u};r.restChances.push(s)}function Zn(n,e){return n instanceof ChainNode&&n.functionName===e?!0:n.parentNode?Zn(n.parentNode,e):!1}function fe(n,e,r){if(e.restChances.length===0){Be(n,e,r);return}var t=e.restChances.pop();e.scanner.setIndex(t.tokenIndex),ie({node:t.node,store:e,visiterOption:r,childIndex:t.childIndex})}function Be(n,e,r){r.onFail&&r.onFail(n)}function Le(n,e){var r=[],t=!1,i={generateAst:!1,enableFirstSet:!1,onMatchNode:function(o,s,l){o===n&&t===!1?(t=!0,ae(o,s,l,null)):r.push(o),fe(o,s,l)}};return je({node:n,scanner:new Ve([]),visiterOption:i,parser:e}),r}function Xn(n,e,r,t){if(r.enableFirstSet&&n.creatorFunction&&t===0&&e.parser.firstSet.has(n.creatorFunction)){var i=e.parser.firstSet.get(n.creatorFunction);return i.some(function(u){return u.run(e.scanner,!1).match})?!1:(fe(n,e,r),!0)}}function Qn(n,e){if(!e.firstSet.has(n.creatorFunction)){var r=Re(n,n.creatorFunction,e);e.firstOrFunctionSet.set(n.creatorFunction,r),Qe(n.creatorFunction,e)}}function Re(n,e,r){if(n instanceof le){if(n.childs[0])return Re(n.childs[0],e,r)}else{if(n instanceof me)return n.childs.reduce(function(t,i){return t.concat(Re(i,e,r))},[]);if(n instanceof ee)return[n];if(n instanceof Me)return r.relatedSet.has(n.chainFunction)?r.relatedSet.get(n.chainFunction).add(e):r.relatedSet.set(n.chainFunction,new Set([e])),[n.chainFunction];throw Error("Unexpected node: ".concat(n))}}function Qe(n,e){if(!e.firstSet.has(n)){var r=e.firstOrFunctionSet.get(n),t=r.reduce(function(u,o){return typeof o=="string"&&e.firstSet.has(o)?u=u.concat(e.firstSet.get(o)):u.push(o),u},[]);if(e.firstOrFunctionSet.set(n,t),t.every(function(u){return u instanceof ee})&&(e.firstSet.set(n,t),e.relatedSet.has(n))){var i=e.relatedSet.get(n);i.forEach(function(u){return Qe})}}}var Yn=function(){function n(e){T()(this,n),this.lexerConfig=e}return O()(n,[{key:"tokenize",value:function(r){for(var t=[],i,u=0;(o=r)!==null&&o!==void 0&&o.length;){var o,s=this.getNextToken(r);if(!s||!s.token)throw Error('Lexer: Unexpected string "'.concat(r,'".'));if(i=s.token,!i.value)throw Error("Lexer: Regex parse error, please check your lexer config.");i.position=[u,u+i.value.length-1],u+=i.value.length,r=r.substring(i.value.length),s.config.ignore||t.push(i)}return t}},{key:"getNextToken",value:function(r){var t=be()(this.lexerConfig),i;try{for(t.s();!(i=t.n()).done;){var u=i.value,o=be()(u.regexes),s;try{for(o.s();!(s=o.n()).done;){var l=s.value,c=this.getTokenOnFirstMatch({input:r,type:u.type,regex:l});if(c)return{token:c,config:u}}}catch(y){o.e(y)}finally{o.f()}}}catch(y){t.e(y)}finally{t.f()}return null}},{key:"getTokenOnFirstMatch",value:function(r){var t=r.input,i=r.type,u=r.regex,o=t.match(u);if(o)return{type:i,value:o[1]}}}]),n}(),qn=function(e){return function(r){return new Yn(e).tokenize(r)}},_n=qn([{type:"whitespace",regexes:[/^(\s+)/],ignore:!0},{type:"comment",regexes:[/^((?:#|--).*?(?:\n|$))/,/^(\/\*[^]*?(?:\*\/|$))/],ignore:!0},{type:"number",regexes:[/^([0-9]+(\.[0-9]+)?|0x[0-9a-fA-F]+|0b[01]+)\b/]},{type:"word",regexes:[/^([a-zA-Z0-9_]+)/,/^(\$\{[a-zA-Z0-9_]+\})/]},{type:"string",regexes:[/^((?=")(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"))/,/^((?=')(?:'[^'\\]*(?:\\[\s\S][^'\\]*)*'))/,/^((?=`)(?:`[^`\\]*(?:\\[\s\S][^`\\]*)*`))/]},{type:"special",regexes:[/^(\(|\))/,/^(!=|<>|==|<=|>=|!<|!>|\|\||::|->>|->|~~\*|~~|!~~\*|!~~|~\*|!~\*|!~|.)/]}]);function er(n){var e=function(){return a(t,r)(function(c){return c[0]})},r=function l(){return a(b(o,t,l))()},t=function(){return a(s,i)(function(c){return c[0]})},i=function l(){return a(b(u,s,l))()},u=function(){return a(["*","/","%"])(function(c){return c[0]})},o=function(){return a(["+","-"])(function(c){return c[0]})},s=function(){return a([a("(",e,")")(function(c){return c[1]}),n])(function(c){return c[0]})};return e}var nr=["select","create","insert","from","where","order","limit","by","sounds","like","is","in","between","regexp","isnull","lateral","left","right","inner","outer","join"],Ye=function(){return a([a(["char","varchar","tinytext","text","mediumtext","longtext"])(function(e){return e[0]}),a(["tinyint","smallint","mediumint","int","integer","bigint"])(function(e){return e[0]}),a(["real","double","float"])(function(e){return e[0]}),a(["decimal","numberic"])(function(e){return e[0]}),a(["date","tinyblob","blob","mediumblob","longblob","bool","boolean"])(function(e){return e[0]}),a(["bit","time","timestamp","datetime","binary","varbinary","year"])(function(e){return e[0]}),a(["enum","set"])(function(e){return e[0]}),a("geometrycollection","linestring","multilinestring","multipoint","multipolygon","point","polygon")(function(e){return e[0]})])(function(e){return e[0]})},qe=function(){return a(R,"=",[W,J])()},rr=function(){return a(qe,k(",",qe))()},R=function(){return a([ye("cursor"),ye("word",{excludes:nr})])(function(e){return e[0]})},W=function(){return a(ye("string"))(function(e){return e[0]})},J=function(){return a(ye("number"))(function(e){return e[0]})},ne=function(){return a([R,W])(function(e){return e[0]})},tr=function(){return a([R,W,ir])(function(e){return e[0]})},ir=function(){return a(b(["-","+"]),J)()},ar=function(){return a(["and","&&","xor","or","||"])(function(e){return e[0]})},ur=function(){return a(["&&","||"])(function(e){return e[0]})},or=function(){return a(["=",">","<","<=",">=","<>","!=","<=>"])(function(e){return e[0]})},sr=function(){return a(["not","!"])(function(e){return e[0]})},cr=function(){return a(["all","distinct","distinctrow","high_priority","straight_join","sql_small_result","sql_big_result","sql_buffer_result","sql_cache","sql_no_cache","sql_calc_found_rows"])(function(e){return e[0]})};function lr(n){return n!=null}function ve(n){return n.filter(function(e){return lr(e)}).reduce(function(e,r){return e.concat(r)},[])}function _e(n){var e={type:"identifier",variant:"tableName"};return Object.keys(n).forEach(function(r){e[r]=n[r]}),e.tableNames=Object.keys(n),e}var fr=function(){return a(vr,b(";"))(function(e){return e[0]})},vr=function(){return a(en,k(a(";",en)(function(e){return e[1]})))(ve)},en=function(){return a([ue,br,Cr,Fr,Hr,Ur,Qr,Yr,qr])(function(e){return e[0]})},ue=function n(){return a("select",hr,b(pr),b(sn),b(Mr),b(dr,n))(function(e){var r={type:"statement",variant:"select",result:e[1],from:e[2]};return e[5]&&(r.union=e[5]),r})},dr=function(){return a("union",["all","distinct"])()},pr=function(){return a("from",gr,b(Se),b(Ir),b(wr))(function(e){return{sources:e[1],where:e[2],group:e[3],having:e[4]}})},hr=function(){return a(nn,k(mr))(ve)},mr=function(){return a(",",nn)(function(e){return e[1]})},nn=function(){return a([a(k("not"),[a(G,b(Er))(function(e){return e[0]}),a("(",G,")")()],b(Ke))(function(e){return{type:"identifier",variant:"column",name:e[1],alias:e[2]}}),"*"])(function(e){return e[0]})},Se=function(){return a("where",Y)(function(e){return e[1]})},rn=function(){return a(q,k(",",q))()},gr=function(){return a(tn,k(a(",",tn)(function(e){return e[1]})))(ve)},tn=function(){return a(He,k(yr))(function(e){return{source:e[0],joins:e[1],type:"statement",variant:"tableSource"}})},He=function(){return a([a(on,b(Ke))(function(e){return{type:"identifier",variant:"tableName",name:e[0],alias:e[1]}}),a([ue,a("(",ue,")")(function(e){return e[1]})],Ke)(function(e){return B()(B()({},e[0]),{},{alias:e[1]})})])(function(e){return e[0]})},yr=function(){return a(["join","straight_join",a(["inner","cross","full"],"join")(),a(["left","right"],b("outer"),"join")(),a("natural",b(["left","right"],b("outer")),"join")()],He,b("on",Y))(function(e){return{type:"statement",variant:"join",join:e[1],conditions:e[2]}})},Ke=function(){return a([a("as",ne)(function(e){return e[1]}),ne])(function(e){return e[0]})},br=function(){return a("create","table",ne,"(",xr,")",b(Sr))()},Sr=function(){return a("with","(",Nr,")")()},Nr=function(){return a(an,k(",",an))()},an=function(){return a(R,"=",W)()},xr=function(){return a(un,k(",",un))()},un=function(){return a(ne,Ye)()},lt=function n(){return chain(wordSym,optional(",",n))()},on=function(){return a([a(ne)(),a(ne,".",ne)(function(e){return[e[0],e[2]]})])(function(e){if(e[0].length===1)return _e({namespace:null,tableName:e[0][0]});if(e[0].length===2)return _e({namespace:e[0][0],tableName:e[0][1]})})},wr=function(){return a("having",Y)()},Fr=function(){return a("create","view",R,"as",ue)()},Cr=function(){return a("insert",b("ignore"),"into",on,b(Tr),[ue])(function(e){return{type:"statement",variant:"insert",into:{type:"indentifier",variant:"table",name:e[3]},result:e[5]}})},Tr=function(){return a("(",kr,")")()},kr=function(){return a(R,k(",",R))()},Ir=function(){return a("group","by",rn)()},sn=function(){return a("order","by",Or)()},Or=function(){return a(cn,k(",",cn))()},cn=function(){return a(Y,b(["asc","desc"]))()},Pr=function(){return a([R,a("partition","by",Y)()])(function(e){return e})},Er=function(){return a("over","(",Ar,")")()},Ar=function n(){return a([Pr,a(G,sn)()],k(",",n))()},Mr=function(){return a("limit",[J,a(J,",",J)(),a(J,"offset",J)()])()},Vr=function(){return a([Br,ln,jr])(function(e){return e[0]})},jr=function(){return a("if","(",Ne,",",G,",",G,")")(function(e){return{type:"function",name:"if",args:[e[2],e[4],e[6]]}})},Br=function(){return a("cast","(",G,"as",Ye,")")(function(e){return{type:"function",name:"cast",args:[e[2],e[4]]}})},ln=function(){return a(R,"(",b(Lr),")",b("filter","(",Se,")"))(function(e){return{type:"function",name:e[0],args:e[2]}})},Lr=function(){return a(fn,k(",",fn))()},fn=function(){return a(k(cr),[q,vn])(function(e){return e})},vn=function(){return a("case",Ue(Rr),b("else",[q,"null"]),["end",a("end","as",R)()])()},Rr=function(){return a("when",Y,"then",hn)()},Hr=function(){return a("set",Kr)()},Kr=function(){return a(dn,k(",",dn))()},dn=function(){return a(Dr,"=",["true","false",W,J])()},Dr=function(){return a(R,k(".",R))()},Y=function n(){return a($r,k(ar,n))(ve)},$r=function(){return a([a("(",Y,")")(),a(sr,Y)(),a(zr)],b(a("is",b("not"),["true","false","unknown"])()))(function(e){return e[0]})},zr=function(){return a(Ne,k(["isnull",a([a("is","not")(),"is","not"],["null",q])()]))(ve)},Ne=function n(){return a([a(q,pn)(),a("(",n,")",pn)()])()},pn=function(){return a(b([a(or,q)(),a("sounds","like",q)(),Wr]),b(["or",Ne]))()},q=function(){return a(G)(function(e){return{type:"identifier",variant:"column",name:e[0]}})},Wr=function(){return a(b("is"),b("not"),[a("in","(",[ue,rn],")")(),a("between",G,"and",Ne)(),a("like",G,b("escape",G))(),a("regexp",G)(),"null"])()},hn=function(){return a(mn,k(ur,mn))(function(e){return e[1]?[e[0],e[1]]:e[0]})},mn=function(){return a([Vr,vn,a(tr,b([a(".","*")(function(e){return{type:"identifier",variant:"groupAll"}}),a(":",ln)(),Gr]))(function(e){return e[1]?B()(B()({},e[1]),{},{groupName:e[0]}):e[0]}),"*"])(function(e){return e[0]})},Gr=function(){return a(".",[W,J,a(R)(function(e){return{type:"identifier",variant:"columnAfterGroup",name:e[0]}})])(function(e){return e[1]})},G=function(){return er(hn)()},Ur=function(){return a("create","index",Jr,Zr,Se)()},Jr=function(){return a(W,k(".",W))()},Zr=function(){return a("ON",W,"(",Xr,")")()},gn=function(){return a(W,b(["ASC","DESC"]))()},Xr=function(){return a(gn,k(",",gn))()},Qr=function(){return a("create","function",R,"as",W)()},Yr=function(){return a("update",He,"SET",rr,b(Se))()},qr=function(){return a("chs",["\u963F\u8FBE","asd","qweqe"],"SET",["field1","field2"])()},_r=Gn(fr,_n,{cursorTokenExcludes:function(e){return e.value==="."||e.value===":"}}),yn=["0.13.2","0.15.6"];function et(n,e,r){if(r=x.defaults(r||{},new On(n)),yn.indexOf(r.monacoEditorVersion)===-1)throw Error("monaco-editor version ".concat(r.monacoEditorVersion," is not allowed, only support ").concat(yn.join(" ")));var t=null,i=0;e.onDidChangeModelContent(function(u){i++;var o=i;t=new Promise(function(s){setTimeout(function(){var l=e.getModel();bn(e.getValue(),l.getOffsetAt(e.getPosition()),r.parserType).then(function(c){if(console.log("parseResult",c),s(c),o===i)if(r.onParse(c),c.error){var y=c.error.reason==="incomplete"?`Incomplete, expect next input: 
`.concat(c.error.suggestions.map(function(h){return h.value}).join(`
`)):`Wrong input, expect: 
`.concat(c.error.suggestions.map(function(h){return h.value}).join(`
`)),p=c.error.token?{startLineNumber:l.getPositionAt(c.error.token.position[0]).lineNumber,startColumn:l.getPositionAt(c.error.token.position[0]).column,endLineNumber:l.getPositionAt(c.error.token.position[1]).lineNumber,endColumn:l.getPositionAt(c.error.token.position[1]).column+1}:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0};l.getPositionAt(c.error.token),n.editor.setModelMarkers(l,r.language,[B()(B()({},p),{},{message:y,severity:nt(n,r.monacoEditorVersion)})])}else n.editor.setModelMarkers(e.getModel(),r.language,[])})})})}),n.languages.registerCompletionItemProvider(r.language,{triggerCharacters:" $.:{}=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),provideCompletionItems:function(){var u=z()(C()().mark(function s(){var l,c,y,p,h,S,$,H,g;return C()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return l=i,m.next=3,t;case 3:if(c=m.sent,l===i){m.next=6;break}return m.abrupt("return",oe([],r.monacoEditorVersion));case 6:return m.next=8,xe(c.ast,c.cursorKeyPath);case 8:if(y=m.sent,console.log("cursorInfo",y),p=r.pipeKeywords(c.nextMatchings),y){m.next=13;break}return m.abrupt("return",oe(p,r.monacoEditorVersion));case 13:m.t0=y.type,m.next=m.t0==="tableField"?16:m.t0==="tableFieldAfterGroup"?24:m.t0==="tableName"?28:m.t0==="functionName"?32:33;break;case 16:return m.next=18,Ce(c.ast,c.cursorKeyPath,r.onSuggestTableFields);case 18:return h=m.sent,S=x.groupBy(h.filter(function(A){return A.groupPickerName!==null}),"groupPickerName"),m.next=22,r.onSuggestFunctionName(y.token.value);case 22:return $=m.sent,m.abrupt("return",oe(h.concat(p).concat($).concat(S?Object.keys(S).map(function(A){return r.onSuggestFieldGroup(A)}):[]),r.monacoEditorVersion));case 24:return m.next=26,Ce(c.ast,c.cursorKeyPath,r.onSuggestTableFields);case 26:return H=m.sent,m.abrupt("return",oe(H.filter(function(A){return A.groupPickerName===y.groupName}).concat(p),r.monacoEditorVersion));case 28:return m.next=30,r.onSuggestTableNames(y);case 30:return g=m.sent,m.abrupt("return",oe(g.concat(p),r.monacoEditorVersion));case 32:return m.abrupt("return",r.onSuggestFunctionName(y.token.value));case 33:return m.abrupt("return",oe(p,r.monacoEditorVersion));case 34:case"end":return m.stop()}},s)}));function o(){return u.apply(this,arguments)}return o}()}),n.languages.registerHoverProvider(r.language,{provideHover:function(){var u=z()(C()().mark(function s(l,c){var y,p,h,S,$;return C()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,bn(e.getValue(),l.getOffsetAt(c),r.parserType);case 2:return y=g.sent,g.next=5,xe(y.ast,y.cursorKeyPath);case 5:if(p=g.sent,p){g.next=8;break}return g.abrupt("return",null);case 8:h=[],g.t0=p.type,g.next=g.t0==="tableField"?12:g.t0==="tableFieldAfterGroup"?19:g.t0==="tableName"?26:g.t0==="functionName"?30:34;break;case 12:return g.next=14,ze(y.ast,p,r.onSuggestTableFields,y.cursorKeyPath);case 14:return S=g.sent,g.next=17,r.onHoverTableField(p.token.value,S);case 17:return h=g.sent,g.abrupt("break",34);case 19:return g.next=21,ze(y.ast,p,r.onSuggestTableFields,y.cursorKeyPath);case 21:return $=g.sent,g.next=24,r.onHoverTableField(p.token.value,$);case 24:return h=g.sent,g.abrupt("break",34);case 26:return g.next=28,r.onHoverTableName(p);case 28:return h=g.sent,g.abrupt("break",34);case 30:return g.next=32,r.onHoverFunctionName(p.token.value);case 32:return h=g.sent,g.abrupt("break",34);case 34:return g.abrupt("return",{range:n.Range.fromPositions(l.getPositionAt(p.token.position[0]),l.getPositionAt(p.token.position[1]+1)),contents:h});case 35:case"end":return g.stop()}},s)}));function o(s,l){return u.apply(this,arguments)}return o}()})}var De=0,bn=function(){var n=z()(C()().mark(function e(r,t,i){var u,o,s,l,c;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return console.log("asyncParser",{text:r,index:t,parserType:i}),De++,u=De,o=null,s=null,l=new Promise(function(h,S){o=h,s=S}),u===De?(c=_r(r,t),o(c)):s(),p.abrupt("return",l);case 8:case"end":return p.stop()}},e)}));return function(r,t,i){return n.apply(this,arguments)}}();function oe(n,e){switch(e){case"0.13.2":return n;case"0.15.6":return{suggestions:n};default:throw Error("Not supported version")}}function nt(n,e){switch(e){case"0.13.2":return n.Severity.Error;case"0.15.6":return n.MarkerSeverity.Error;default:throw Error("Not supported version")}}var Sn=d(62086),rt=O()(function n(){T()(this,n)}),tt=O()(function n(){T()(this,n)}),Nn=function(n){M()(r,n);var e=te()(r);function r(){var t;T()(this,r);for(var i=arguments.length,u=new Array(i),o=0;o<i;o++)u[o]=arguments[o];return t=e.call.apply(e,[this].concat(u)),f()(L()(t),"state",new tt),f()(L()(t),"root",void 0),t}return O()(r,[{key:"componentDidMount",value:function(){var i=this;it().then(function(u){var o=u.editor.create(Cn.findDOMNode(i.root),{value:[""].join(`
`),language:"sql"});et(u,o)})}},{key:"render",value:function(){var i=this;return(0,Sn.jsx)("div",{style:{width:"100%",height:600},ref:function(o){i.root=o}})}}]),r}(Fn.PureComponent);f()(Nn,"defaultProps",new rt);function it(){return new Promise(function(n){at("https://unpkg.com/monaco-editor/min/vs/loader.js",function(){var e=window,r=e.require;r.config({paths:{vs:"https://unpkg.com/monaco-editor/min/vs"}}),window.MonacoEnvironment={getWorkerUrl:function(){return"data:text/javascript;charset=utf-8,".concat(encodeURIComponent(`
          self.MonacoEnvironment = {
            baseUrl: 'https://unpkg.com/monaco-editor/min/'
          };
          importScripts('https://unpkg.com/monaco-editor/min/vs/base/worker/workerMain.js');`))}},r(["vs/editor/editor.main"],function(t){n(t)})})})}function at(n,e){var r=document.createElement("script"),t;r.setAttribute("src",n),e&&(r.onreadystatechange=r.onload=function(){t||e(),t=!0}),document.getElementsByTagName("head")[0].appendChild(r)}var ut=function(e){return(0,Sn.jsx)(Nn,{})},ot=ut},68608:function(v){function P(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}v.exports=P,v.exports.__esModule=!0,v.exports.default=v.exports},54689:function(v,P,d){var D=d(41442);function L(w,M){var I=typeof Symbol!="undefined"&&w[Symbol.iterator]||w["@@iterator"];if(!I){if(Array.isArray(w)||(I=D(w))||M&&w&&typeof w.length=="number"){I&&(w=I);var te=0,ce=function(){};return{s:ce,n:function(){return te>=w.length?{done:!0}:{done:!1,value:w[te++]}},e:function(T){throw T},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f=!0,X=!1,O;return{s:function(){I=I.call(w)},n:function(){var T=I.next();return f=T.done,T},e:function(T){X=!0,O=T},f:function(){try{!f&&I.return!=null&&I.return()}finally{if(X)throw O}}}}v.exports=L,v.exports.__esModule=!0,v.exports.default=v.exports},38888:function(v,P,d){var D=d(44908),L=d(14614),w=d(91621);function M(I){var te=L();return function(){var f=D(I),X;if(te){var O=D(this).constructor;X=Reflect.construct(f,arguments,O)}else X=f.apply(this,arguments);return w(this,X)}}v.exports=M,v.exports.__esModule=!0,v.exports.default=v.exports},44908:function(v){function P(d){return v.exports=P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(L){return L.__proto__||Object.getPrototypeOf(L)},v.exports.__esModule=!0,v.exports.default=v.exports,P(d)}v.exports=P,v.exports.__esModule=!0,v.exports.default=v.exports},58853:function(v,P,d){var D=d(49154);function L(w,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(M&&M.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),M&&D(w,M)}v.exports=L,v.exports.__esModule=!0,v.exports.default=v.exports},14614:function(v){function P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}v.exports=P,v.exports.__esModule=!0,v.exports.default=v.exports},91621:function(v,P,d){var D=d(37635).default,L=d(68608);function w(M,I){if(I&&(D(I)==="object"||typeof I=="function"))return I;if(I!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L(M)}v.exports=w,v.exports.__esModule=!0,v.exports.default=v.exports},49154:function(v){function P(d,D){return v.exports=P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,M){return w.__proto__=M,w},v.exports.__esModule=!0,v.exports.default=v.exports,P(d,D)}v.exports=P,v.exports.__esModule=!0,v.exports.default=v.exports}}]);
